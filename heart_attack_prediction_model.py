# -*- coding: utf-8 -*-
"""Heart_Attack_Prediction_Model.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1A5VdbuAJlhzYq0bmz0C08msJz5j2nGBA
"""

import numpy as np
import pandas as pd
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras.models import Model

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_absolute_error
from sklearn.metrics import accuracy_score
from sklearn.utils import shuffle

import matplotlib.pyplot as plt

raw_data = pd.read_csv('https://raw.githubusercontent.com/Mannat-Rana/Heart_Attack_Predictor/main/heart.csv')
raw_data.tail()

features = raw_data.drop(columns=['output'])
labels = raw_data['output'].values
normalizer = MinMaxScaler()
normalizer.fit(features)
features = normalizer.transform(features)
features, labels = shuffle(features, labels)
num_classes = len(np.unique(labels))
num_features = features.shape[1]
x_train, x_test, y_train, y_test = train_test_split(features, labels, test_size=0.33, random_state=1)

model = tf.keras.Sequential([tf.keras.layers.Input(shape = (n_features,)),
                             tf.keras.layers.Dense(32, activation='relu',kernel_initializer='he_normal'),
                             tf.keras.layers.Dense(16, activation='relu',kernel_initializer='he_normal'),
                             tf.keras.layers.Dropout(0.02),
                             tf.keras.layers.Dense(32, activation='relu',kernel_initializer='he_normal'),
                             tf.keras.layers.Dense(1, activation='linear'),
                             tf.keras.layers.Dense(n_class, activation = 'softmax')
                             ])
accuracy = tf.keras.metrics.SparseCategoricalAccuracy()
model.compile(loss = ['mse', 'sparse_categorical_crossentropy'],
              metrics = [accuracy], 
              optimizer = 'adam')

model.summary()

history = model.fit(x_train, y_train, epochs=100, batch_size=32, verbose=3, validation_data=(x_test, y_test))

acc = history.history['sparse_categorical_accuracy']
val_acc = history.history['val_sparse_categorical_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']
epochs = range(len(acc))
plt.plot(epochs, acc, 'r', label = 'Training Accuracy')
plt.plot(epochs, val_acc, 'b', label = 'Validation Accuracy')
plt.title('Training and Validation Accuracy')
plt.legend(loc = 0)
plt.figure()
plt.plot(epochs, loss, 'r', label = 'Training Loss')
plt.plot(epochs, val_loss, 'b', label = 'Validation Loss')
plt.title('Training and Validation Loss')
plt.legend(loc = 0)
plt.figure()
plt.show()